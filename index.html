<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>The Family Social</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    * { box-sizing: border-box; margin:0; padding:0; }
    body { background:#f0f0f0; font-family:Arial,sans-serif; font-size:14px; color:#1c1e21; }
    .topbar { background:#fff; border-bottom:1px solid #ddd; position:fixed; top:0; left:0; right:0; height:56px; z-index:1000; display:flex; align-items:center; padding:0 16px; box-shadow:0 1px 2px rgba(0,0,0,0.05); }
    .logo { font-family:"Comic Sans MS",cursive; font-size:24px; font-weight:bold; color:#000080; text-decoration:none; }
    .nav { flex:1; display:flex; justify-content:center; gap:8px; }
    .nav-btn { background:#e7f3ff; color:#000080; border:none; padding:8px 16px; border-radius:6px; font-weight:600; font-size:13px; cursor:pointer; }
    .nav-btn:hover { background:#d8efff; }
    .nav-btn.active { background:#000080; color:white; }

    .container { max-width:500px; margin:70px auto 20px; padding:0 10px; }
    .card { background:white; border-radius:8px; box-shadow:0 1px 3px rgba(0,0,0,0.1); margin-bottom:16px; overflow:hidden; }
    .banner { background:#ffff00; color:#d80000; font-weight:bold; font-size:11px; text-align:center; padding:4px 0; animation:blink 2s infinite; }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.7} }
    .welcome { text-align:center; padding:20px; color:#000080; font-family:"Comic Sans MS",cursive; }
    .family-photo { width:100%; height:200px; object-fit:cover; border-bottom:3px solid #000080; }
    .tiktok-box { text-align:center; padding:16px; background:#f8f9fa; border-top:1px solid #ddd; }
    .tiktok-btn { background:#ff0050; color:white; padding:8px 16px; border-radius:6px; text-decoration:none; font-weight:bold; font-size:14px; display:inline-block; margin-top:8px; }

    #auth, #post-form, #feed { display:none; }
    .post { padding:12px; border-bottom:1px solid #ddd; }
    .post img, .post video { max-width:100%; border-radius:6px; margin:8px 0; }
    .post small { color:#65676b; font-size:12px; }

    .footer { text-align:center; padding:20px; color:#8a8d91; font-size:12px; }
    .footer a { color:#0000ee; text-decoration:underline; margin:0 4px; }
  </style>
</head>
<body>

  <div class="topbar">
    <a href="index.html" class="logo">The Family</a>
    <div class="nav">
      <button class="nav-btn active">Home</button>
      <button class="nav-btn" onclick="location.href='connections.html'">Connections</button>
      <button class="nav-btn" onclick="location.href='co-op.html'">Co-op</button>
    </div>
  </div>

  <div class="container">
    <div class="banner" id="btc-banner">*** LIVE BTC PRICE: Loading... ***</div>

    <div class="card">
      <div class="welcome">
        <h1>Welcome to Our Family!</h1>
        <p>Private • Safe • Fun</p>
      </div>
      <img src="https://i.postimg.cc/C5zknfPL/IMG-4991.jpg" alt="Family" class="family-photo">
      <div class="tiktok-box">
        <p style="margin:0;font-size:16px;color:#ff0050;font-weight:bold;">Follow us on TikTok!</p>
        <a href="https://tiktok.com/@thefamilycrypto" target="_blank" class="tiktok-btn">Follow Now!</a>
      </div>
    </div>

    <!-- AUTH -->
    <div id="auth" class="card" style="padding:20px;text-align:center;">
      <h3 style="color:#000080;">Join the Family</h3>
      <input type="email" id="email" placeholder="Email" style="width:100%;padding:10px;margin:6px 0;border:1px solid #ddd;border-radius:6px;"><br>
      <input type="password" id="password" placeholder="Password" style="width:100%;padding:10px;margin:6px 0;border:1px solid #ddd;border-radius:6px;"><br>
      <input type="text" id="invite-code" placeholder="Invite Code" style="width:100%;padding:10px;margin:6px 0;border:1px solid #ddd;border-radius:6px;"><br>
      <button class="nav-btn" style="width:100%;margin:8px 0;" onclick="signUp()">Sign Up</button>
      <button class="nav-btn" style="width:100%;background:#1877f2;color:white;" onclick="logIn()">Log In</button>
      <p id="auth-msg" style="color:red;margin-top:8px;"></p>
    </div>

    <!-- POST FORM -->
    <div id="post-form" class="card" style="padding:16px;">
      <textarea id="post-content" placeholder="What's on your mind?" style="width:100%;height:80px;padding:12px;border:1px solid #ddd;border-radius:6px;resize:none;"></textarea>
      <input type="file" id="media-file" accept="image/*,video/*" style="margin:8px 0;">
      <button class="nav-btn" style="width:100%;background:#42b72a;color:white;" onclick="createPost()">Post</button>
    </div>

    <!-- FEED -->
    <div id="feed"></div>

    <div class="footer">
      © 2021-2025 The Family Club. All Rights Reserved.<br>
      <a href="#">Privacy</a> | <a href="#">Terms</a> | <a href="#">Help</a>
    </div>
  </div>

<script>
  const SUPABASE_URL = 'https://your-project.supabase.co';  // CHANGE
  const SUPABASE_ANON_KEY = 'your-anon-key';                // CHANGE
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  let currentUser = null;

  async function signUp() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const code = document.getElementById('invite-code').value;
    const valid = ['FAMILY2025', 'ANNA', 'JORDAN'];
    if (!valid.includes(code.toUpperCase())) return showMsg('Invalid code', 'red');
    const { error } = await supabase.auth.signUp({ email, password });
    if (error) showMsg(error.message, 'red');
    else showMsg('Check email to confirm!', 'green');
  }

  async function logIn() {
    const { data, error } = await supabase.auth.signInWithPassword({
      email: document.getElementById('email').value,
      password: document.getElementById('password').value
    });
    if (error) showMsg(error.message, 'red');
    else { currentUser = data.user; showDashboard(); loadFeed(); }
  }

  function showMsg(msg, color) {
    const el = document.getElementById('auth-msg');
    el.textContent = msg; el.style.color = color;
  }

  function showDashboard() {
    document.getElementById('auth').style.display = 'none';
    document.getElementById('post-form').style.display = 'block';
    document.getElementById('feed').style.display = 'block';
  }

  async function createPost() {
    const content = document.getElementById('post-content').value;
    const file = document.getElementById('media-file').files[0];
    let mediaUrl = null;
    if (file) {
      const { data, error } = await supabase.storage.from('posts').upload(`public/${Date.now()}_${file.name}`, file);
      if (error) return alert('Upload failed');
      mediaUrl = `${SUPABASE_URL}/storage/v1/object/public/posts/${data.path}`;
    }
    await supabase.from('posts').insert({ user_id: currentUser.id, content, media_url: mediaUrl });
    document.getElementById('post-content').value = '';
    document.getElementById('media-file').value = '';
    loadFeed();
  }

  async function loadFeed() {
    const { data: posts } = await supabase.from('posts').select('*').order('created_at', { ascending: false });
    const feed = document.getElementById('feed');
    feed.innerHTML = '';
    posts.forEach(p => {
      const div = document.createElement('div');
      div.className = 'card post';
      div.innerHTML = `<b>${p.content.slice(0,100)}${p.content.length > 100 ? '...' : ''}</b><br>
        <small>By ${p.user_id.slice(0,8)}... • ${new Date(p.created_at).toLocaleString()}</small>
        ${p.media_url ? (p.media_url.includes('.mp4') ? `<video controls style="max-height:300px;"><source src="${p.media_url}"></video>` : `<img src="${p.media_url}">`) : ''}`;
      feed.appendChild(div);
    });
  }

  supabase.auth.getSession().then(({ data }) => {
    if (data.session) { currentUser = data.session.user; showDashboard(); loadFeed(); }
    else document.getElementById('auth').style.display = 'block';
  });

  async function fetchPrices() {
    try {
      const r = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd');
      const d = await r.json();
      document.getElementById('btc-banner').innerHTML = `*** BTC: $${d.bitcoin.usd.toLocaleString()} ***`;
    } catch (e) { document.getElementById('btc-banner').innerHTML = '*** BTC: Offline ***'; }
  }
  fetchPrices(); setInterval(fetchPrices, 30000);
</script>
</body>
</html>
